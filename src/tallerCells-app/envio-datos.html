<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="envio-datos">
    <template>
        <style>
            :host {
                display: block
            }
        </style>

        <iron-ajax
            id="registroMongo"
            method="post"
            url="https://api.mlab.com/api/1/databases/dduarte/collections/movimientos"
            params='{"apiKey":"GOLqWa850qO8tsdCUdby6eq9eKPInBkt"}'
            body='[{"nombre": "{{nombre}}"}]'
            handle-as="json"
            content-type="application/json"
            on-response="_handleResponse"
            on-error="_handleError"
            ></iron-ajax>

        

    </template>

    <script>
        class EnvioDatos extends Polymer.Element {
            static get is() {
                return 'envio-datos';
            }
            static get properties() {
                return {

                    datos:{
                        type:Object,
                        notify:true,
                        observer: 'setDatos'
                    },

                    datosobject: {
                        type: Object,
                        value: function(){
                            return{
                                nombre:'{{this.datosarray.nombre}}',
                                clave:'{{this.datosarray.clave}}'
                                }
                        }
                    },
                    datosarray: {
                        type: Array,
                    },

                    nombre:{
                        type: String
                    }
                    
                };
            }

            setDatos(){

                this.set('datosarray',this.datos);
                this.set('nombre',this.datosarray.nombre);
                console.log("otra vez: ", this.datosarray);
                console.log("nombre: ", this.datosarray.nombre);
                console.log('Datos: ',this.datos);
                console.log('datosArray: ', this.datosarray);
            }

            _handleResponse(e){
                console.log("evento",e);
                this.dispatchEvent(new CustomEvent('respueastaapi', {detail: e.detail.__data.response}
                ));
            }

            _handleError(e){
                console.log('Evento Error: ', e.detail.error);
            }

            ejecutrajax(){
                this.$.registroMongo.generateRequest();
                console.log("Entra a ejecutar: ");
            }


        }

        window.customElements.define(EnvioDatos.is, EnvioDatos);
    </script>
</dom-module>